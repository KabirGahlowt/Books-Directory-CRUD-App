<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Books Directory</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        input,
        button {
            margin: 5px;
        }

        .book {
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <h1>Books Directory</h1>

    <h2>Add a Book</h2>
    <input type="text" id="title" placeholder="Title" />
    <input type="text" id="author" placeholder="Author" />
    <input type="date" id="publishedDate" placeholder="Published Date" />
    <input type="number" id="pages" placeholder="Pages" />
    <input type="text" id="genre" placeholder="Genre" />
    <button onclick="addBook()">Add Book</button>

    <h2>All Books</h2>
    <input type="text" id="searchInput" placeholder="Search by title or author" oninput="fetchBooks()" />
    <button onclick="fetchBooks()">Refresh List</button>
    <div id="booksList"></div>

    <script>
        async function fetchBooks() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            const res = await fetch('/books');
            let books = await res.json();

            if (searchTerm) {
                books = books.filter(book =>
                    (book.title && book.title.toLowerCase().includes(searchTerm)) ||
                    (book.author && book.author.toLowerCase().includes(searchTerm))
                );
            }

            const booksList = document.getElementById('booksList');
            booksList.innerHTML = '';

            books.forEach(book => {
                const div = document.createElement('div');
                div.className = 'book';
                div.innerHTML = `
            <strong>${book.title}</strong><br/>
            Author: ${book.author || 'N/A'}<br/>
            Published Date: ${book.publishedDate ? new Date(book.publishedDate).toDateString() : 'N/A'}<br/>
            Pages: ${book.pages || 'N/A'}<br/>
            Genre: ${book.genre || 'N/A'}<br/>
            <button onclick="deleteBook('${book._id}')">Delete</button>
            <button onclick="editBook('${book._id}')">Edit</button>
        `;
                booksList.appendChild(div);
            });
        }


        async function addBook() {
            const book = {
                title: document.getElementById('title').value,
                author: document.getElementById('author').value,
                publishedDate: document.getElementById('publishedDate').value,
                pages: parseInt(document.getElementById('pages').value),
                genre: document.getElementById('genre').value,
            };

            const res = await fetch('/books', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(book)
            });

            if (res.ok) {
                alert('Book added!');
                fetchBooks();
                clearForm();
            } else {
                alert('Failed to add book.');
            }
        }

        async function deleteBook(id) {
            if (!confirm('Are you sure you want to delete this book?')) return;

            const res = await fetch(`/books/${id}`, { method: 'DELETE' });

            if (res.ok) {
                alert('Book deleted!');
                fetchBooks();
            } else {
                alert('Failed to delete book.');
            }
        }

        function clearForm() {
            document.getElementById('title').value = '';
            document.getElementById('author').value = '';
            document.getElementById('publishedDate').value = '';
            document.getElementById('pages').value = '';
            document.getElementById('genre').value = '';
        }

        function editBook(id) {
            const title = prompt('Enter new title:');
            const author = prompt('Enter new author:');
            const publishedDate = prompt('Enter new published date (YYYY-MM-DD):');
            const pages = prompt('Enter new pages:');
            const genre = prompt('Enter new genre:');

            fetch(`/books/${id}`, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title, author, publishedDate, pages: +pages, genre })
            }).then(res => {
                if (res.ok) {
                    alert('Book updated!');
                    fetchBooks();
                } else {
                    alert('Failed to update book.');
                }
            });
        }

        // Fetch books on page load
        fetchBooks();
    </script>
</body>

</html>